//ejs-interval
interval=function(a,b){if(this.func=a,"string"==typeof b)this.time=this.convert(b);else if("number"==typeof b)this.time=b;else throw new TypeError("Unexpected input");this.running=!1},interval.prototype.start=function(){return!this.running&&(this.startTime=Date.now(),this.intervalID=setInterval(this.func,this.time),this.running=!0,!0)},interval.prototype.end=function(){return!!this.running&&(clearInterval(this.intervalID),this.running=!1,this.startTime=void 0,this.intervalID=void 0,!0)},interval.prototype.stop=function(){return this.end()},interval.prototype.startIn=function(a){if("string"==typeof a&&(a=this.convert(a)),!this.running&&"number"==typeof a)setTimeout(this.start.bind(this),a);else if("number"!=typeof a)throw new TypeError("startTime must be a number");else if(this.running)return!1},interval.prototype.endIn=function(a){if("string"==typeof a&&(a=this.convert(a)),this.running&&"number"==typeof a)setTimeout(this.end.bind(this),a);else if("number"!=typeof a)throw new TypeError("endTime must be a number");else if(!this.running)return!1},interval.prototype.stopIn=function(a){return this.endIn(a)},interval.prototype.convert=function(a){if("string"!=typeof a)throw new TypeError("time must be a string");let b,c,d,e=0;if(b=a.match(/([0-9]+[a-z]+)/g),null==b)throw new Error("Unexpected input");for(let f of b)c=f.match(/[a-z]+/g)[0],d=+f.match(/[0-9]+/g)[0],"h"===c||"hr"===c||"hrs"===c?e+=36e5*d:"m"===c||"min"===c?e+=6e4*d:"s"===c||"sec"===c?e+=1e3*d:"ms"===c?e+=d:void 0;return e};

//toastr
!function(e){e(["jquery"],function(e){return function(){function t(e,t,n){return g({type:O.error,iconClass:m().iconClasses.error,message:e,optionsOverride:n,title:t})}function n(t,n){return t||(t=m()),v=e("#"+t.containerId),v.length?v:(n&&(v=d(t)),v)}function o(e,t,n){return g({type:O.info,iconClass:m().iconClasses.info,message:e,optionsOverride:n,title:t})}function s(e){C=e}function i(e,t,n){return g({type:O.success,iconClass:m().iconClasses.success,message:e,optionsOverride:n,title:t})}function a(e,t,n){return g({type:O.warning,iconClass:m().iconClasses.warning,message:e,optionsOverride:n,title:t})}function r(e,t){var o=m();v||n(o),u(e,o,t)||l(o)}function c(t){var o=m();return v||n(o),t&&0===e(":focus",t).length?void h(t):void(v.children().length&&v.remove())}function l(t){for(var n=v.children(),o=n.length-1;o>=0;o--)u(e(n[o]),t)}function u(t,n,o){var s=!(!o||!o.force)&&o.force;return!(!t||!s&&0!==e(":focus",t).length)&&(t[n.hideMethod]({duration:n.hideDuration,easing:n.hideEasing,complete:function(){h(t)}}),!0)}function d(t){return v=e("<div/>").attr("id",t.containerId).addClass(t.positionClass),v.appendTo(e(t.target)),v}function p(){return{tapToDismiss:!0,toastClass:"toast",containerId:"toast-container",debug:!1,showMethod:"fadeIn",showDuration:300,showEasing:"swing",onShown:void 0,hideMethod:"fadeOut",hideDuration:1e3,hideEasing:"swing",onHidden:void 0,closeMethod:!1,closeDuration:!1,closeEasing:!1,closeOnHover:!0,extendedTimeOut:1e3,iconClasses:{error:"toast-error",info:"toast-info",success:"toast-success",warning:"toast-warning"},iconClass:"toast-info",positionClass:"toast-top-right",timeOut:5e3,titleClass:"toast-title",messageClass:"toast-message",escapeHtml:!1,target:"body",closeHtml:'<button type="button">&times;</button>',closeClass:"toast-close-button",newestOnTop:!0,preventDuplicates:!1,progressBar:!1,progressClass:"toast-progress",rtl:!1}}function f(e){C&&C(e)}function g(t){function o(e){return null==e&&(e=""),e.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function s(){c(),u(),d(),p(),g(),C(),l(),i()}function i(){var e="";switch(t.iconClass){case"toast-success":case"toast-info":e="polite";break;default:e="assertive"}I.attr("aria-live",e)}function a(){E.closeOnHover&&I.hover(H,D),!E.onclick&&E.tapToDismiss&&I.click(b),E.closeButton&&j&&j.click(function(e){e.stopPropagation?e.stopPropagation():void 0!==e.cancelBubble&&e.cancelBubble!==!0&&(e.cancelBubble=!0),E.onCloseClick&&E.onCloseClick(e),b(!0)}),E.onclick&&I.click(function(e){E.onclick(e),b()})}function r(){I.hide(),I[E.showMethod]({duration:E.showDuration,easing:E.showEasing,complete:E.onShown}),E.timeOut>0&&(k=setTimeout(b,E.timeOut),F.maxHideTime=parseFloat(E.timeOut),F.hideEta=(new Date).getTime()+F.maxHideTime,E.progressBar&&(F.intervalId=setInterval(x,10)))}function c(){t.iconClass&&I.addClass(E.toastClass).addClass(y)}function l(){E.newestOnTop?v.prepend(I):v.append(I)}function u(){if(t.title){var e=t.title;E.escapeHtml&&(e=o(t.title)),M.append(e).addClass(E.titleClass),I.append(M)}}function d(){if(t.message){var e=t.message;E.escapeHtml&&(e=o(t.message)),B.append(e).addClass(E.messageClass),I.append(B)}}function p(){E.closeButton&&(j.addClass(E.closeClass).attr("role","button"),I.prepend(j))}function g(){E.progressBar&&(q.addClass(E.progressClass),I.prepend(q))}function C(){E.rtl&&I.addClass("rtl")}function O(e,t){if(e.preventDuplicates){if(t.message===w)return!0;w=t.message}return!1}function b(t){var n=t&&E.closeMethod!==!1?E.closeMethod:E.hideMethod,o=t&&E.closeDuration!==!1?E.closeDuration:E.hideDuration,s=t&&E.closeEasing!==!1?E.closeEasing:E.hideEasing;if(!e(":focus",I).length||t)return clearTimeout(F.intervalId),I[n]({duration:o,easing:s,complete:function(){h(I),clearTimeout(k),E.onHidden&&"hidden"!==P.state&&E.onHidden(),P.state="hidden",P.endTime=new Date,f(P)}})}function D(){(E.timeOut>0||E.extendedTimeOut>0)&&(k=setTimeout(b,E.extendedTimeOut),F.maxHideTime=parseFloat(E.extendedTimeOut),F.hideEta=(new Date).getTime()+F.maxHideTime)}function H(){clearTimeout(k),F.hideEta=0,I.stop(!0,!0)[E.showMethod]({duration:E.showDuration,easing:E.showEasing})}function x(){var e=(F.hideEta-(new Date).getTime())/F.maxHideTime*100;q.width(e+"%")}var E=m(),y=t.iconClass||E.iconClass;if("undefined"!=typeof t.optionsOverride&&(E=e.extend(E,t.optionsOverride),y=t.optionsOverride.iconClass||y),!O(E,t)){T++,v=n(E,!0);var k=null,I=e("<div/>"),M=e("<div/>"),B=e("<div/>"),q=e("<div/>"),j=e(E.closeHtml),F={intervalId:null,hideEta:null,maxHideTime:null},P={toastId:T,state:"visible",startTime:new Date,options:E,map:t};return s(),r(),a(),f(P),E.debug&&console&&console.log(P),I}}function m(){return e.extend({},p(),b.options)}function h(e){v||(v=n()),e.is(":visible")||(e.remove(),e=null,0===v.children().length&&(v.remove(),w=void 0))}var v,C,w,T=0,O={error:"error",info:"info",success:"success",warning:"warning"},b={clear:r,remove:c,error:t,getContainer:n,info:o,options:{},subscribe:s,success:i,version:"2.1.3",warning:a};return b}()})}("function"==typeof define&&define.amd?define:function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t(require("jquery")):window.toastr=t(window.jQuery)});

//tagsinput
$(function(){$("div.tags-input").each(function(){let a=$(this).find("input").eq(0),b=$("<div/>",{class:"tags-area"});$(this).prepend(b),$(this).on("click",function(){a[0].focus()}.bind(a)),a.on("keydown",function(a){let c,d=$(a.currentTarget),e=tagsInputRead(a.currentTarget.parentElement,!0);switch(a.key){case",":case"Enter":case" ":if(a.preventDefault(),""==d.val())return;let f=$("<span/>").html(d.val()).attr("data-value",d.val());f.append($("<button/>").html("X").on("click",function(){$(this.parentElement).remove()})),d.val(""),b.append(f);break;case"Backspace":if(""!=d.val()||""==e)return;a.preventDefault(),b.find("span").last().remove();break;case"ArrowLeft":if(b.find("span").last().remove(),""!=d.val())return;if(a.preventDefault(),-1!=e.indexOf(",")){let a=e.split(",");c=a.pop(),e=a.join(",")}else c=e;d.val(c);}}),a.on("blur",function(){let a=$(this),b=a.parent().find("div").eq(0);if(""!=a.val()){let c=$("<span/>").html(a.val()).attr("data-value",a.val());c.append($("<button/>").html("X").on("click",function(){$(this.parentElement).remove()})),a.val(""),b.append(c)}}),a.on("input",function(a){a.currentTarget.value=a.currentTarget.value.toLowerCase().replace(/[^0-9a-z]/g,"")})})});function tagsInputRead(a,b){let c=[];for(let d of $(a).find(".tags-area").find("span"))c.push($(d).data("value"));return b?c.join(","):c}

//neko
var neko={data:{timers:[],settings:{}},cache:{storage:"",lastTick:{}}};$(function(){neko.init()}),neko.init=function(){$("#reminder-submit").on("click",neko.submit),"default"===Notification.permission&&Notification.requestPermission(),neko.ticker=new interval(neko.tick,100),window.addEventListener("blur",function(){$("#reminder-onblur-setting").prop("checked")&&neko.ticker.running&&(neko.ticker.end(),neko.ticker.time=1e3*+$("#reminder-blurmode-interval").val(),neko.ticker.start())}),window.addEventListener("focus",function(){100!=neko.ticker.time&&(neko.ticker.end(),neko.ticker.time=100,0<neko.data.timers.length&&neko.ticker.start())}),neko.loadStorage()},neko.submit=function(){let a=tagsInputRead($("#reminder-number")[0]),b=0,c=$("#reminder-note").val().replace("<","&lt;").replace(">","&gt;"),d=Date.now();if(!(1>a.length)){for(let c in a)/^([0-9]+)(h|hr|m|min|s|sec)$/g.test(a[c])?b+=interval.prototype.convert(a[c]):/^[0-9]+$/g.test(a[c])&&(b+=interval.prototype.convert(a[c]+"s"));0==b||(b+=d,neko.createTimer({target:b,note:c,startedAt:d}),toastr.success("Created Timer &quot;"+(c||"Untitled Timer")+"&quot;","Created Timer"),neko.ticker.start())}},neko.createTimer=function(a){let b,c=a.startedAt;b=new Date(a.target),(a.note===void 0||""===a.note)&&(a.note="Untitled Timer"),a.id===void 0&&(a.id=c.toString(16)),a.status="running",a.lastTick===void 0?neko.cache.lastTick[a.id]=c:(neko.cache.lastTick[a.id]=a.lastTick,delete a.lastTick),el=$("<div>",{id:a.id,class:"timer"});let d=$("<div>",{class:"timer-controls"});el.append($(d)),d.append($("<button>",{class:"right"}).html(">").on("click",function(){let a=$(this).parent().parent();0==a.next().length||a.insertAfter(a.next())})),d.append($("<button>",{class:"close"}).html("X").on("click",function(){let b=neko.data[a.id],c=$("#"+b.id);if("running"==b.status){if(0<c.find(".confirm-box").length)return;let a=$("<div/>",{class:"confirm-box"});return a.html("Do you really want to delete &quot;"+b.note+"&quot;?<br><br>").append($("<button/>").html("Yes").on("click",function(){neko.removeTimer($(this).parent().parent().attr("id"))})).append($("<button/>").html("No").on("click",function(){$(this).parent().remove()})),void c.append(a)}neko.removeTimer(b.id)}.bind(a))),d.append($("<button>",{class:"left"}).html("<").on("click",function(){let a=$(this).parent().parent();0==a.prev().length||a.insertBefore(a.prev())})),el.append($("<h2>",{title:a.note}).html(a.note)),el.append($("<div>",{class:"progress"}).append($("<div>",{class:"progress-value"}).css("width","0%").html("0%"))),el.append($("<span>",{class:"small"}).html("Ends in <span>"+neko.timeFromMilliseconds(a.target-a.lastTick)+"</span> (at "+b.toLocaleTimeString()+")")),$("#timer-area").append(el),neko.data.timers.push(a.id),neko.data[a.id]=a,neko.updateStorage()},neko.removeTimer=function(a){let b=neko.data[a].note;neko.data.timers.splice(neko.data.timers.indexOf(a),1),delete neko.data[a],$("#"+a).remove(),toastr.success("Deleted Timer &quot;"+(b||"Untitled Timer")+"&quot;","Deleted Timer"),neko.updateStorage()},neko.tick=function(){if(1>neko.data.timers.length)return void neko.ticker.end();neko.data.timers.map(a=>"finished"===neko.data[a].status).every(a=>!0===a)&&neko.ticker.end();let a=$("#timer-area").find(".timer"),b=[];for(let c of a){let a=neko.data[c.id];if(b.push(c.id),"running"!=a.status)continue;let d=Date.now(),e=100*((d-a.startedAt)/(a.target-a.startedAt)),f=$("#"+c.id).find(".progress-value"),g=d-neko.cache.lastTick[c.id];if(neko.cache.lastTick[c.id]=d,$("#"+c.id).find("span.small > span").html(neko.timeFromMilliseconds(a.target-d)),100<=e)return f.css("width","100%").html("100%").addClass("progress-finished"),a.status="finished",new Notification("Your Timer \""+a.note+"\" ended!"),void toastr.info("Timer &quot;"+a.note+"&quot; ended","Timer ended");f.css("width",e.toString()+"%").html((0|e).toString()+"%")}neko.data.timers=b,neko.updateStorage()},neko.timeFromMilliseconds=function(a){let b=Math.ceil(+a/1e3),c=!1,d="";if(0>b&&(b=0),3600<=b){let a=0|b/3600;b-=3600*a,d+=(10>a?"0":"")+a.toString()+":",c=!0}if(c||60<=b){let a=0|b/60;b-=60*a,d+=(10>a?"0":"")+a.toString()+":"}else d+="00:";return d+=(10>b?"0":"")+b.toString(),d},neko.updateStorage=function(){if($("#reminder-allow-cookie")[0].checked){neko.data.settings.cookieEnabled="enabled",neko.data.settings.blurModeEnabled=$("#reminder-onblur-setting").prop("checked")?"enabled":"disabled",neko.data.settings.blurModeInterval=+$("#reminder-blurmode-interval").val(),neko.data.settings.darkmodeEnabled=$("#reminder-darkmode-setting").prop("checked")?"enabled":"disabled";let a=JSON.stringify(neko.data);if(a==neko.cache.storage)return;localStorage.setItem("nekoreminder",a),neko.cache.storage=a}else localStorage.removeItem("nekoreminder");$("#reminder-darkmode-setting").prop("checked")?!$(document.body).hasClass("darkmode")&&$(document.body).addClass("darkmode"):$(document.body).hasClass("darkmode")&&$(document.body).removeClass("darkmode")},neko.loadStorage=function(){let a=localStorage.getItem("nekoreminder");if(null===a)return!1;neko.cache.storage=a,a=JSON.parse(a),$("#reminder-allow-cookie").prop("checked",!0),"enabled"===a.settings.blurModeEnabled&&$("#reminder-onblur-setting").prop("checked",!0),$("#reminder-blurmode-interval").val(a.settings.blurModeInterval),"enabled"===a.settings.darkmodeEnabled&&($("#reminder-darkmode-setting").prop("checked",!0),$(document.body).addClass("darkmode"));let b=a,c=b.timers;for(let a of c){let c=b[a];neko.createTimer(c),toastr.success("Loaded Timer &quot;"+c.note+"&quot; from cookies.","Loaded Timer")}0<c.length&&neko.ticker.start()},toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!0,positionClass:"toast-top-right",preventDuplicates:!1,onclick:null,showDuration:"300",hideDuration:"1000",timeOut:"5000",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};
